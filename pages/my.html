<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人健康档案 - 饭了么</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- 头部导航 -->
        <header class="header">
            <div class="nav-container">
                <div class="logo">
                    <i class="fas fa-carrot"></i> 饭了么
                </div>
                
                <div class="nav-links">
                    <a href="recipe.html">食谱</a>
                    <a href="store.html">商城</a>
                    <a href="my.html" style="color: var(--primary-color);">我的</a>
                </div>
                
                <div class="search-container">
                    <input type="text" placeholder="搜索健康食谱...">
                    <button><i class="fas fa-search"></i></button>
                </div>
            </div>
        </header>
        
        <!-- 个人资料区域 -->
        <div class="profile-section">
            <div class="avatar-container">
                <img src="images/user-avatar.jpg" alt="用户头像">
            </div>
            
            <div class="user-info">
                <h1 class="welcome-text" id="username-display">您好，亲爱的用户</h1>
                <p>欢迎查看您的健康档案，今日减脂计划已准备就绪！</p>
                
                <div class="user-stats">
                    <div class="stat-item">
                        <div class="stat-value">14</div>
                        <div class="stat-label">减脂天数</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">3.6kg</div>
                        <div class="stat-label">已减体重</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">87%</div>
                        <div class="stat-label">计划完成度</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 热量卡片 -->
        <div class="calorie-card">
            <div class="card-header">
                <h2 class="card-title"><i class="fas fa-fire"></i> 今日能量摄入统计</h2>
                <div class="card-date">2025年7月10日</div>
            </div>
            
            <div class="calorie-content">
                <div class="calorie-goal">
                    <h3>每日热量目标：<strong>1500 千卡</strong></h3>
                    <div class="goal-progress">
                        <div class="progress-bar" style="width: 54%"></div>
                        <div class="progress-text">810/1500 千卡</div>
                    </div>
                    
                    <div class="calorie-details">
                        <div class="detail-item">
                            <div class="detail-value">810</div>
                            <div class="detail-label">已摄入</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-value remaining">690</div>
                            <div class="detail-label">剩余可摄入</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-value">54%</div>
                            <div class="detail-label">完成度</div>
                        </div>
                    </div>
                </div>
                
                <div class="calorie-recommend">
                    <h3 class="recommend-title"><i class="fas fa-lightbulb"></i> 晚餐建议</h3>
                    <ul class="recommend-list">
                        <li>选择热量≤500千卡的菜品</li>
                        <li>推荐：蔬菜沙拉配鸡胸肉（约350千卡）</li>
                        <li>可选：番茄鸡蛋汤（约200千卡）</li>
                        <li>避免：油炸食品、高糖食物</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- 图表区域 -->
        <div class="chart-container">
            <div class="chart-header">
                <h2 class="card-title"><i class="fas fa-chart-line"></i> 周度热量趋势</h2>
                <div class="chart-actions">
                    <button class="time-btn active" data-period="week">本周</button>
                    <button class="time-btn" data-period="last-week">上周</button>
                    <button class="time-btn" data-period="month">本月</button>
                </div>
            </div>
            
            <div class="chart-wrapper">
                <canvas id="calorie-chart"></canvas>
                <div class="chart-loading" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i> 加载中...
                </div>
            </div>
        </div>

        <!-- 添加CSS样式 -->
        <style>
            .chart-wrapper {
                position: relative;
                height: 250px; /* 调整图表高度 */
                margin-top: 20px;
            }
            
            .chart-loading {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(255, 255, 255, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 1.2rem;
                color: var(--primary-color);
            }
            
            .chart-loading i {
                margin-right: 10px;
            }
        </style>

        <!-- 修改JavaScript代码 -->
        <script>
            // 图表数据
            const chartData = {
                'week': {
                    labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                    data: [1420, 1580, 1360, 1510, 1480, 1620, 1450]
                },
                'last-week': {
                    labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                    data: [1380, 1520, 1470, 1430, 1560, 1490, 1410]
                },
                'month': {
                    labels: ['第1周', '第2周', '第3周', '第4周'],
                    data: [10200, 10500, 9800, 10700]
                }
            };

            let calorieChart = null;

            // 初始化热量图表
            function initCalorieChart(period = 'week') {
                const ctx = document.getElementById('calorie-chart').getContext('2d');
                const data = chartData[period];
                
                if (calorieChart) {
                    calorieChart.destroy();
                }
                
                calorieChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.labels,
                        datasets: [
                            {
                                label: '目标热量',
                                data: data.labels.map(() => 1500),
                                backgroundColor: 'rgba(78, 205, 196, 0.2)',
                                borderColor: 'rgba(78, 205, 196, 1)',
                                borderWidth: 1,
                                type: 'line',
                                fill: false,
                                pointRadius: 4,
                                pointBackgroundColor: 'rgba(78, 205, 196, 1)'
                            },
                            {
                                label: '实际摄入',
                                data: data.data,
                                backgroundColor: data.data.map(value => 
                                    value > 1500 ? 'rgba(231, 76, 60, 0.7)' : 'rgba(46, 204, 113, 0.7)'),
                                borderColor: data.data.map(value => 
                                    value > 1500 ? 'rgba(231, 76, 60, 1)' : 'rgba(46, 204, 113, 1)'),
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false,
                                min: Math.min(...data.data) - 200,
                                max: Math.max(...data.data) + 200,
                                title: {
                                    display: true,
                                    text: '热量 (千卡)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw} 千卡`;
                                    },
                                    afterLabel: function(context) {
                                        if (context.datasetIndex === 1) {
                                            const target = 1500;
                                            const diff = context.raw - target;
                                            if (diff > 0) {
                                                return `超量: +${diff} 千卡`;
                                            } else if (diff < 0) {
                                                return `剩余: ${-diff} 千卡`;
                                            }
                                            return '刚好达标';
                                        }
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // 设置用户名
            document.addEventListener('DOMContentLoaded', function() {
                const username = localStorage.getItem('username') || '用户';
                document.getElementById('username-display').textContent = `您好，亲爱的${username}`;
                
                // 初始化图表
                initCalorieChart();
                
                // 时间按钮切换
                const timeBtns = document.querySelectorAll('.time-btn');
                const chartLoading = document.querySelector('.chart-loading');
                
            timeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 显示加载状态
                    chartLoading.style.display = 'flex';
                    
                    // 切换按钮状态
                    timeBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 立即更新图表
                    const period = this.dataset.period;
                    initCalorieChart(period);
                    chartLoading.style.display = 'none';
                });
            });
                
                // 编辑按钮事件
                const editBtns = document.querySelectorAll('.edit-btn');
                editBtns.forEach(btn => {
                    btn.addEventListener('click', function() {
                        alert('编辑功能：这里可以修改历史记录数据');
                    });
                });
            });
        </script>        
        <!-- 页脚 -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>关于我们</h3>
                    <ul class="footer-links">
                        <li><a href="#">公司简介</a></li>
                        <li><a href="#">品牌故事</a></li>
                        <li><a href="#">团队介绍</a></li>
                        <li><a href="#">招贤纳士</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>客户服务</h3>
                    <ul class="footer-links">
                        <li><a href="#">帮助中心</a></li>
                        <li><a href="#">售后服务</a></li>
                        <li><a href="#">配送说明</a></li>
                        <li><a href="#">退换政策</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>商务合作</h3>
                    <ul class="footer-links">
                        <li><a href="#">供应商入驻</a></li>
                        <li><a href="#">广告合作</a></li>
                        <li><a href="#">渠道合作</a></li>
                        <li><a href="#">企业采购</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>关注我们</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fab fa-weixin"></i> 微信公众号</a></li>
                        <li><a href="#"><i class="fab fa-weibo"></i> 新浪微博</a></li>
                        <li><a href="#"><i class="fab fa-tiktok"></i> 抖音</a></li>
                        <li><a href="#"><i class="fab fa-instagram"></i> Instagram</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2025 饭了么 - 健康食材商城 | 让新鲜食材直达您的厨房</p>
            </div>
        </footer>
    </div>
    
    <!-- Font Awesome 图标库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    
    <script>
        // 设置用户名
        document.addEventListener('DOMContentLoaded', function() {
            const username = localStorage.getItem('username') || '用户';
            document.getElementById('username-display').textContent = `您好，亲爱的${username}`;
            
            // 初始化图表
            initCalorieChart();
            
            // 时间按钮切换
            const timeBtns = document.querySelectorAll('.time-btn');
            timeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    timeBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // 编辑按钮事件
            const editBtns = document.querySelectorAll('.edit-btn');
            editBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    alert('编辑功能：这里可以修改历史记录数据');
                });
            });
        });
        
        // 初始化热量图表
        function initCalorieChart() {
            const ctx = document.getElementById('calorie-chart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                    datasets: [
                        {
                            label: '目标热量',
                            data: [1500, 1500, 1500, 1500, 1500, 1500, 1500],
                            backgroundColor: 'rgba(78, 205, 196, 0.2)',
                            borderColor: 'rgba(78, 205, 196, 1)',
                            borderWidth: 1,
                            type: 'line',
                            fill: false,
                            pointRadius: 4,
                            pointBackgroundColor: 'rgba(78, 205, 196, 1)'
                        },
                        {
                            label: '实际摄入',
                            data: [1420, 1580, 1360, 1510, 1480, 1620, 1450],
                            backgroundColor: [
                                'rgba(46, 204, 113, 0.7)',
                                'rgba(231, 76, 60, 0.7)',
                                'rgba(46, 204, 113, 0.7)',
                                'rgba(231, 76, 60, 0.7)',
                                'rgba(46, 204, 113, 0.7)',
                                'rgba(231, 76, 60, 0.7)',
                                'rgba(46, 204, 113, 0.7)'
                            ],
                            borderColor: [
                                'rgba(46, 204, 113, 1)',
                                'rgba(231, 76, 60, 1)',
                                'rgba(46, 204, 113, 1)',
                                'rgba(231, 76, 60, 1)',
                                'rgba(46, 204, 113, 1)',
                                'rgba(231, 76, 60, 1)',
                                'rgba(46, 204, 113, 1)'
                            ],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '热量 (千卡)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: '本周热量摄入 vs 目标'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.raw} 千卡`;
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>